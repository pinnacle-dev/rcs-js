// This file was auto-generated by Fern from our API Definition.

import * as Pinnacle from "../../../src/api/index";
import { PinnacleClient } from "../../../src/Client";
import { mockServerPool } from "../../mock-server/MockServerPool";

describe("Blast", () => {
    test("sms (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "aud_abc123",
            senders: ["+14155164736", "+14155164737"],
            message: { text: "Hello from Pinnacle!" },
        };
        const rawResponseBody = {
            blastId: "blast_1234567890",
            audienceId: "aud_abc123",
            totalRecipients: 1000,
            totalMessages: 1000,
            totalSegments: 1500,
            totalCost: 15,
        };
        server
            .mockEndpoint()
            .post("/messages/blast/sms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.messages.blast.sms({
            audienceId: "aud_abc123",
            senders: ["+14155164736", "+14155164737"],
            message: {
                text: "Hello from Pinnacle!",
            },
        });
        expect(response).toEqual({
            blastId: "blast_1234567890",
            audienceId: "aud_abc123",
            totalRecipients: 1000,
            totalMessages: 1000,
            totalSegments: 1500,
            totalCost: 15,
        });
    });

    test("sms (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "aud_abc123",
            senders: ["+14155164736", "+14155164737"],
            message: { text: "Hello from Pinnacle!" },
        };
        const rawResponseBody = {
            scheduleId: "msg_sched_xxxxx",
            config: {
                sendAt: "2024-12-25T10:00",
                recurrence: "0 10 * * ? *",
                timezone: "America/Los_Angeles",
                endDate: "2024-12-31T23:59",
            },
        };
        server
            .mockEndpoint()
            .post("/messages/blast/sms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.messages.blast.sms({
            audienceId: "aud_abc123",
            senders: ["+14155164736", "+14155164737"],
            message: {
                text: "Hello from Pinnacle!",
            },
        });
        expect(response).toEqual({
            scheduleId: "msg_sched_xxxxx",
            config: {
                sendAt: "2024-12-25T10:00",
                recurrence: "0 10 * * ? *",
                timezone: "America/Los_Angeles",
                endDate: "2024-12-31T23:59",
            },
        });
    });

    test("sms (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { audienceId: "audienceId", senders: ["senders", "senders"], message: { text: "text" } };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/messages/blast/sms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.sms({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    text: "text",
                },
            });
        }).rejects.toThrow(Pinnacle.BadRequestError);
    });

    test("sms (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { audienceId: "audienceId", senders: ["senders", "senders"], message: { text: "text" } };
        const rawResponseBody = { error: "error" };
        server
            .mockEndpoint()
            .post("/messages/blast/sms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.sms({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    text: "text",
                },
            });
        }).rejects.toThrow(Pinnacle.UnauthorizedError);
    });

    test("sms (5)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { audienceId: "audienceId", senders: ["senders", "senders"], message: { text: "text" } };
        const rawResponseBody = { error: "error" };
        server
            .mockEndpoint()
            .post("/messages/blast/sms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(402)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.sms({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    text: "text",
                },
            });
        }).rejects.toThrow(Pinnacle.PaymentRequiredError);
    });

    test("sms (6)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { audienceId: "audienceId", senders: ["senders", "senders"], message: { text: "text" } };
        const rawResponseBody = { error: "error" };
        server
            .mockEndpoint()
            .post("/messages/blast/sms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.sms({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    text: "text",
                },
            });
        }).rejects.toThrow(Pinnacle.ForbiddenError);
    });

    test("sms (7)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { audienceId: "audienceId", senders: ["senders", "senders"], message: { text: "text" } };
        const rawResponseBody = { error: "error" };
        server
            .mockEndpoint()
            .post("/messages/blast/sms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.sms({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    text: "text",
                },
            });
        }).rejects.toThrow(Pinnacle.InternalServerError);
    });

    test("mms (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "aud_abc123",
            senders: ["+14155164736", "+14155164737"],
            message: { mediaUrls: ["https://fastly.picsum.photos/id/941/300/300.jpg"], text: "Check out this image!" },
            options: { validate: true },
        };
        const rawResponseBody = {
            blastId: "blast_1234567890",
            audienceId: "aud_abc123",
            totalRecipients: 500,
            totalMessages: 500,
            totalSegments: 1000,
            totalCost: 30,
        };
        server
            .mockEndpoint()
            .post("/messages/blast/mms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.messages.blast.mms({
            audienceId: "aud_abc123",
            senders: ["+14155164736", "+14155164737"],
            message: {
                mediaUrls: ["https://fastly.picsum.photos/id/941/300/300.jpg"],
                text: "Check out this image!",
            },
            options: {
                validate: true,
            },
        });
        expect(response).toEqual({
            blastId: "blast_1234567890",
            audienceId: "aud_abc123",
            totalRecipients: 500,
            totalMessages: 500,
            totalSegments: 1000,
            totalCost: 30,
        });
    });

    test("mms (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "aud_abc123",
            senders: ["+14155164736", "+14155164737"],
            message: { mediaUrls: ["https://fastly.picsum.photos/id/941/300/300.jpg"], text: "Check out this image!" },
            options: { validate: true },
        };
        const rawResponseBody = {
            scheduleId: "msg_sched_xxxxx",
            config: {
                sendAt: "2024-12-25T10:00",
                recurrence: "recurrence",
                timezone: "America/New_York",
                endDate: "endDate",
            },
        };
        server
            .mockEndpoint()
            .post("/messages/blast/mms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.messages.blast.mms({
            audienceId: "aud_abc123",
            senders: ["+14155164736", "+14155164737"],
            message: {
                mediaUrls: ["https://fastly.picsum.photos/id/941/300/300.jpg"],
                text: "Check out this image!",
            },
            options: {
                validate: true,
            },
        });
        expect(response).toEqual({
            scheduleId: "msg_sched_xxxxx",
            config: {
                sendAt: "2024-12-25T10:00",
                recurrence: "recurrence",
                timezone: "America/New_York",
                endDate: "endDate",
            },
        });
    });

    test("mms (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "audienceId",
            senders: ["senders", "senders"],
            message: { mediaUrls: ["mediaUrls", "mediaUrls"] },
        };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/messages/blast/mms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.mms({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    mediaUrls: ["mediaUrls", "mediaUrls"],
                },
            });
        }).rejects.toThrow(Pinnacle.BadRequestError);
    });

    test("mms (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "audienceId",
            senders: ["senders", "senders"],
            message: { mediaUrls: ["mediaUrls", "mediaUrls"] },
        };
        const rawResponseBody = { error: "error" };
        server
            .mockEndpoint()
            .post("/messages/blast/mms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.mms({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    mediaUrls: ["mediaUrls", "mediaUrls"],
                },
            });
        }).rejects.toThrow(Pinnacle.UnauthorizedError);
    });

    test("mms (5)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "audienceId",
            senders: ["senders", "senders"],
            message: { mediaUrls: ["mediaUrls", "mediaUrls"] },
        };
        const rawResponseBody = { error: "error" };
        server
            .mockEndpoint()
            .post("/messages/blast/mms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(402)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.mms({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    mediaUrls: ["mediaUrls", "mediaUrls"],
                },
            });
        }).rejects.toThrow(Pinnacle.PaymentRequiredError);
    });

    test("mms (6)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "audienceId",
            senders: ["senders", "senders"],
            message: { mediaUrls: ["mediaUrls", "mediaUrls"] },
        };
        const rawResponseBody = { error: "error" };
        server
            .mockEndpoint()
            .post("/messages/blast/mms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.mms({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    mediaUrls: ["mediaUrls", "mediaUrls"],
                },
            });
        }).rejects.toThrow(Pinnacle.ForbiddenError);
    });

    test("mms (7)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "audienceId",
            senders: ["senders", "senders"],
            message: { mediaUrls: ["mediaUrls", "mediaUrls"] },
        };
        const rawResponseBody = { error: "error" };
        server
            .mockEndpoint()
            .post("/messages/blast/mms")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.mms({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    mediaUrls: ["mediaUrls", "mediaUrls"],
                },
            });
        }).rejects.toThrow(Pinnacle.InternalServerError);
    });

    test("rcs (1)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "aud_abc123",
            senders: ["agent_pinnacle", "agent_pinnacle2"],
            message: {
                quickReplies: [{ type: "trigger", payload: "payload", title: "title" }],
                text: "Hello from Pinnacle RCS!",
            },
            fallback: { from: "+14155164736", text: "Hello from Pinnacle! Reply LEARN to learn more." },
            options: { transcode: true, validate: true },
        };
        const rawResponseBody = {
            blastId: "blast_1234567890",
            audienceId: "aud_abc123",
            totalRecipients: 250,
            totalMessages: 250,
            totalSegments: 250,
            totalCost: 8.75,
        };
        server
            .mockEndpoint()
            .post("/messages/blast/rcs")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.messages.blast.rcs({
            audienceId: "aud_abc123",
            senders: ["agent_pinnacle", "agent_pinnacle2"],
            message: {
                quickReplies: [
                    {
                        type: "trigger",
                        payload: "payload",
                        title: "title",
                    },
                ],
                text: "Hello from Pinnacle RCS!",
            },
            fallback: {
                from: "+14155164736",
                text: "Hello from Pinnacle! Reply LEARN to learn more.",
            },
            options: {
                transcode: true,
                validate: true,
            },
        });
        expect(response).toEqual({
            blastId: "blast_1234567890",
            audienceId: "aud_abc123",
            totalRecipients: 250,
            totalMessages: 250,
            totalSegments: 250,
            totalCost: 8.75,
        });
    });

    test("rcs (2)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "aud_abc123",
            senders: ["agent_pinnacle", "agent_pinnacle2"],
            message: {
                quickReplies: [{ type: "trigger", payload: "payload", title: "title" }],
                text: "Hello from Pinnacle RCS!",
            },
            fallback: { from: "+14155164736", text: "Hello from Pinnacle! Reply LEARN to learn more." },
            options: { transcode: true, validate: true },
        };
        const rawResponseBody = {
            scheduleId: "msg_sched_xxxxx",
            config: {
                sendAt: "2024-12-25T10:00",
                recurrence: "0/30 * * * ? *",
                timezone: "UTC",
                endDate: "2024-12-25T18:00",
            },
        };
        server
            .mockEndpoint()
            .post("/messages/blast/rcs")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.messages.blast.rcs({
            audienceId: "aud_abc123",
            senders: ["agent_pinnacle", "agent_pinnacle2"],
            message: {
                quickReplies: [
                    {
                        type: "trigger",
                        payload: "payload",
                        title: "title",
                    },
                ],
                text: "Hello from Pinnacle RCS!",
            },
            fallback: {
                from: "+14155164736",
                text: "Hello from Pinnacle! Reply LEARN to learn more.",
            },
            options: {
                transcode: true,
                validate: true,
            },
        });
        expect(response).toEqual({
            scheduleId: "msg_sched_xxxxx",
            config: {
                sendAt: "2024-12-25T10:00",
                recurrence: "0/30 * * * ? *",
                timezone: "UTC",
                endDate: "2024-12-25T18:00",
            },
        });
    });

    test("rcs (3)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "audienceId",
            senders: ["senders", "senders"],
            message: {
                quickReplies: [
                    { type: "openUrl", payload: "payload", title: "title" },
                    { type: "openUrl", payload: "payload", title: "title" },
                ],
                text: "text",
            },
        };
        const rawResponseBody = { key: "value" };
        server
            .mockEndpoint()
            .post("/messages/blast/rcs")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(400)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.rcs({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    quickReplies: [
                        {
                            type: "openUrl",
                            payload: "payload",
                            title: "title",
                        },
                        {
                            type: "openUrl",
                            payload: "payload",
                            title: "title",
                        },
                    ],
                    text: "text",
                },
            });
        }).rejects.toThrow(Pinnacle.BadRequestError);
    });

    test("rcs (4)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "audienceId",
            senders: ["senders", "senders"],
            message: {
                quickReplies: [
                    { type: "openUrl", payload: "payload", title: "title" },
                    { type: "openUrl", payload: "payload", title: "title" },
                ],
                text: "text",
            },
        };
        const rawResponseBody = { error: "error" };
        server
            .mockEndpoint()
            .post("/messages/blast/rcs")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(401)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.rcs({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    quickReplies: [
                        {
                            type: "openUrl",
                            payload: "payload",
                            title: "title",
                        },
                        {
                            type: "openUrl",
                            payload: "payload",
                            title: "title",
                        },
                    ],
                    text: "text",
                },
            });
        }).rejects.toThrow(Pinnacle.UnauthorizedError);
    });

    test("rcs (5)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "audienceId",
            senders: ["senders", "senders"],
            message: {
                quickReplies: [
                    { type: "openUrl", payload: "payload", title: "title" },
                    { type: "openUrl", payload: "payload", title: "title" },
                ],
                text: "text",
            },
        };
        const rawResponseBody = { error: "error" };
        server
            .mockEndpoint()
            .post("/messages/blast/rcs")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(402)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.rcs({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    quickReplies: [
                        {
                            type: "openUrl",
                            payload: "payload",
                            title: "title",
                        },
                        {
                            type: "openUrl",
                            payload: "payload",
                            title: "title",
                        },
                    ],
                    text: "text",
                },
            });
        }).rejects.toThrow(Pinnacle.PaymentRequiredError);
    });

    test("rcs (6)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "audienceId",
            senders: ["senders", "senders"],
            message: {
                quickReplies: [
                    { type: "openUrl", payload: "payload", title: "title" },
                    { type: "openUrl", payload: "payload", title: "title" },
                ],
                text: "text",
            },
        };
        const rawResponseBody = { error: "error" };
        server
            .mockEndpoint()
            .post("/messages/blast/rcs")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(403)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.rcs({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    quickReplies: [
                        {
                            type: "openUrl",
                            payload: "payload",
                            title: "title",
                        },
                        {
                            type: "openUrl",
                            payload: "payload",
                            title: "title",
                        },
                    ],
                    text: "text",
                },
            });
        }).rejects.toThrow(Pinnacle.ForbiddenError);
    });

    test("rcs (7)", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = {
            audienceId: "audienceId",
            senders: ["senders", "senders"],
            message: {
                quickReplies: [
                    { type: "openUrl", payload: "payload", title: "title" },
                    { type: "openUrl", payload: "payload", title: "title" },
                ],
                text: "text",
            },
        };
        const rawResponseBody = { error: "error" };
        server
            .mockEndpoint()
            .post("/messages/blast/rcs")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(500)
            .jsonBody(rawResponseBody)
            .build();

        await expect(async () => {
            return await client.messages.blast.rcs({
                audienceId: "audienceId",
                senders: ["senders", "senders"],
                message: {
                    quickReplies: [
                        {
                            type: "openUrl",
                            payload: "payload",
                            title: "title",
                        },
                        {
                            type: "openUrl",
                            payload: "payload",
                            title: "title",
                        },
                    ],
                    text: "text",
                },
            });
        }).rejects.toThrow(Pinnacle.InternalServerError);
    });
});
