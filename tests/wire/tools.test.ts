/**
 * This file was auto-generated by Fern from our API Definition.
 */

import { mockServerPool } from "../mock-server/MockServerPool";
import { PinnacleClient } from "../../src/Client";

describe("Tools", () => {
    test("shortenURL", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { url: "https://example.com" };
        const rawResponseBody = { shortenedUrl: "https://urls.p1n.io/abcd1234", expiresAt: "2023-12-31T23:59:59Z" };
        server
            .mockEndpoint()
            .post("/tools/urls/shorten")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.tools.shortenUrl({
            url: "https://example.com",
        });
        expect(response).toEqual({
            shortenedUrl: "https://urls.p1n.io/abcd1234",
            expiresAt: "2023-12-31T23:59:59Z",
        });
    });

    test("uploadUrl", async () => {
        const server = mockServerPool.createServer();
        const client = new PinnacleClient({ apiKey: "test", environment: server.baseUrl });
        const rawRequestBody = { contentType: "image/png", size: 1024, name: "example.png" };
        const rawResponseBody = {
            upload: "https://server.trypinnacle.app/storage/v1/object/upload/sign/assets/example.png",
            download: "https://server.trypinnacle.app/storage/v1/object/sign/assets/example.png",
        };
        server
            .mockEndpoint()
            .post("/tools/uploadUrl")
            .jsonBody(rawRequestBody)
            .respondWith()
            .statusCode(200)
            .jsonBody(rawResponseBody)
            .build();

        const response = await client.tools.uploadUrl({
            contentType: "image/png",
            size: 1024,
            name: "example.png",
        });
        expect(response).toEqual({
            upload: "https://server.trypinnacle.app/storage/v1/object/upload/sign/assets/example.png",
            download: "https://server.trypinnacle.app/storage/v1/object/sign/assets/example.png",
        });
    });
});
